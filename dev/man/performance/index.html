<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Performance Gotchas · MendelImpute</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">MendelImpute</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../Phasing+and+Imputation/">Phasing and Imputation</a></li><li class="is-active"><a class="tocitem" href>Performance Gotchas</a><ul class="internal"><li><a class="tocitem" href="#Gotcha-1:-Run-MendelImpute-in-parallel"><span>Gotcha 1: Run MendelImpute in parallel</span></a></li><li><a class="tocitem" href="#Gotcha-2:-max_d-too-high-(or-too-low)"><span>Gotcha 2: <code>max_d</code> too high (or too low)</span></a></li><li><a class="tocitem" href="#Gotcha-3:-You-used-memory-swap"><span>Gotcha 3: You used memory swap</span></a></li></ul></li><li><a class="tocitem" href="../painting/">Estimating ancestry</a></li><li><a class="tocitem" href="../ultra+compress/">Ultra compression</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Performance Gotchas</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Performance Gotchas</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/biona001/MendelImpute/blob/master/docs/src/man/performance.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Performance-gotchas"><a class="docs-heading-anchor" href="#Performance-gotchas">Performance gotchas</a><a id="Performance-gotchas-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-gotchas" title="Permalink"></a></h1><h2 id="Gotcha-1:-Run-MendelImpute-in-parallel"><a class="docs-heading-anchor" href="#Gotcha-1:-Run-MendelImpute-in-parallel">Gotcha 1: Run MendelImpute in parallel</a><a id="Gotcha-1:-Run-MendelImpute-in-parallel-1"></a><a class="docs-heading-anchor-permalink" href="#Gotcha-1:-Run-MendelImpute-in-parallel" title="Permalink"></a></h2><p>To run <code>MendelImpute.jl</code> in parallel,</p><ol><li>Execute <code>export JULIA_NUM_THREADS=4</code> <strong>before</strong> starting Julia. We recommend number of threads equal to the number of physical CPU cores on your machine. </li><li>Verify the Julia session is running is parallel by executing <code>Threads.nthreads()</code> in Julia</li><li>Set the number of BLAS threads to be 1 by <code>using LinearAlgebra; BLAS.set_num_threads(1)</code>. This avoids <a href="https://ieeexplore.ieee.org/document/5470434">oversubscription</a>. </li></ol><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Do not use hyper-threading. In other words, don&#39;t set the number of Julia threads to be more than number of physical CPU cores. Hyperthreading is valuable for I/O operations (in our experience), but not for linear algebra routines used throughout MendelImpute. </p></div></div><h2 id="Gotcha-2:-max_d-too-high-(or-too-low)"><a class="docs-heading-anchor" href="#Gotcha-2:-max_d-too-high-(or-too-low)">Gotcha 2: <code>max_d</code> too high (or too low)</a><a id="Gotcha-2:-max_d-too-high-(or-too-low)-1"></a><a class="docs-heading-anchor-permalink" href="#Gotcha-2:-max_d-too-high-(or-too-low)" title="Permalink"></a></h2><p>When you compress the haplotype panels into a <code>.jlso</code> format, you specified <code>max_d</code> which is the maximum number of unique haplotypes per window. We generally recommend using <code>max_d = 1000</code>, BUT 1000 may be too small if you use a reference panel larger than HRC. In that case, you can try larger <code>max_d</code>, which will improve error rate. </p><h3 id="Symptoms-for-max_d-too-high:"><a class="docs-heading-anchor" href="#Symptoms-for-max_d-too-high:">Symptoms for <code>max_d</code> too high:</a><a id="Symptoms-for-max_d-too-high:-1"></a><a class="docs-heading-anchor-permalink" href="#Symptoms-for-max_d-too-high:" title="Permalink"></a></h3><p><code>Computing optimal haplotypes</code> is too slow. In particular, the timing for <code>haplopair search</code> is too high. </p><h3 id="Symptoms-for-max_d-too-low:"><a class="docs-heading-anchor" href="#Symptoms-for-max_d-too-low:">Symptoms for <code>max_d</code> too low:</a><a id="Symptoms-for-max_d-too-low:-1"></a><a class="docs-heading-anchor-permalink" href="#Symptoms-for-max_d-too-low:" title="Permalink"></a></h3><p>Too few typed SNPs per window indicates <code>max_d</code> is set too low. You can calculate the number of typed SNPs per window by dividing the total number of SNPs in the target file by the total windows (a number that will be output after every run). Ideally you want an average of 400 typed SNPs per window, but something as low as 50 still works. Something like 10~20 is too low. </p><h3 id="I-really-want-to-use-a-high-max_d"><a class="docs-heading-anchor" href="#I-really-want-to-use-a-high-max_d">I really want to use a high <code>max_d</code></a><a id="I-really-want-to-use-a-high-max_d-1"></a><a class="docs-heading-anchor-permalink" href="#I-really-want-to-use-a-high-max_d" title="Permalink"></a></h3><p>A high <code>max_d</code> generally improve error, so it is understandable you want to do so. If a high <code>max_d</code> value runs too slow, try setting <code>stepwise = 100</code> and <code>max_haplotypes</code> to a number that is close to 1000. This avoids searching the global minimizer of the least-squares problem for windows that have more than <code>max_haplotypes</code> number of unique haplotypes. Setting <code>thinning_factor</code> instead of <code>stepwise</code> have a similar effect. Details for these 2 heuristic searches are explained in the appendix of our paper. </p><h2 id="Gotcha-3:-You-used-memory-swap"><a class="docs-heading-anchor" href="#Gotcha-3:-You-used-memory-swap">Gotcha 3: You used memory swap</a><a id="Gotcha-3:-You-used-memory-swap-1"></a><a class="docs-heading-anchor-permalink" href="#Gotcha-3:-You-used-memory-swap" title="Permalink"></a></h2><p>While MendelImpute uses the least RAM compared to competing softwares (as of 2020), it is still possible for large imputation problems to consume all available RAM. If this happens, Julia will first try to use <code>swap</code> before crashing (until all of <code>swap</code> is consumed). Monitor your RAM usage constantly to make sure this doesn&#39;t happen. On Mac/Linux machines, the <code>top</code> or <code>htop</code> command will monitor this information. Alternatively, the <code>/usr/bin/time</code> command will automatically records max RAM usage for job and whether any <code>swap</code> had been performed. </p><p>If you do not have the above issues and your code is still running slow, file an issue on GitHub and we will take a look at it ASAP. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Phasing+and+Imputation/">« Phasing and Imputation</a><a class="docs-footer-nextpage" href="../painting/">Estimating ancestry »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 6 September 2020 21:12">Sunday 6 September 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
